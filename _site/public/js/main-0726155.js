(()=>{var e={showDebug:!0,userCanHover:!1,timerInterval:25,timerIntervalVar:void 0,countdownInterval:25,countdownIntervalVar:void 0,timerEl:document.querySelector("#timer"),soundCheckbox:document.querySelector("#sound-checkbox"),focusCheckbox:document.querySelector("#focus-checkbox"),themeDropdown:document.querySelector("#theme-dropdown"),countdownDurationEl:document.querySelector("#countdown-duration"),selectPuzzleEl:document.querySelector("#select-puzzle"),scrambleContainerEl:document.querySelector("#scramble-container"),scrambleEl:document.querySelector("#scramble"),deleteTimesModalId:"delete-times-modal",timesListModalId:"times-list-modal",defaultState:"START",startTime:void 0,currTime:void 0,timerRunning:!1,countdownRunning:!1,countdownPings:[],cooldown:!1,cooldownMs:1e3,modalVisible:!1,configStorageItem:"cmCubeTimerConfig",timesStorageItem:"cmCubeTimerTimes",configObj:{},timesObj:{},timesListLength:10,themesAvailable:["Dark","Light","Newspaper","Trinity","ADHD"],defaults:{soundsOn:!0,focusOn:!1,countdownDuration:"15",theme:"Dark",puzzle:"3x3x3"}};var z=()=>{let t=document.querySelector("#options");if(t){let n=["Puzzle: <strong>".concat(e.puzzle,"</strong>"),"Inspection: <strong>".concat(e.countdownDuration,"s</strong>"),"Theme: <strong>".concat(e.theme,"</strong>"),"Sound: <strong>".concat(e.soundsOn?"On":"Off","</strong>"),"Focus: <strong>".concat(e.focusOn?"On":"Off","</strong>")].join(" ~&bull;~ ");t.innerHTML=n,document.querySelector("#scramble-container .puzzle").innerHTML=e.puzzle}};var I=()=>{console.log(e.configObj)},S=()=>{console.log("getting config");let o=localStorage.getItem(e.configStorageItem)||"{}";e.configObj=JSON.parse(o),I()},a=()=>{let t={soundsOn:e.soundsOn,focusOn:e.focusOn,countdownDuration:e.countdownDuration.toString(),theme:e.theme,puzzle:e.puzzle};console.log("setting config"),e.configObj=t,localStorage.setItem(e.configStorageItem,JSON.stringify(t)),I(),z()};var $=()=>{document.querySelector("#debug")&&(document.querySelector("#getConfig").addEventListener("click",function(i){i.preventDefault(),S()}),document.querySelector("#setConfig").addEventListener("click",function(i){i.preventDefault(),a()}),document.querySelector("#deleteConfig").addEventListener("click",function(i){i.preventDefault(),console.log("deleting config"),localStorage.removeItem(e.configStorageItem)}),document.querySelector("#logTimes").addEventListener("click",function(i){i.preventDefault(),console.log("all times:"),console.log(e.timesObj)}),document.querySelector("#deleteTimes").addEventListener("click",function(i){i.preventDefault(),console.log("deleting all times"),localStorage.removeItem(e.timesStorageItem)}))};var d=(t,o=2)=>{let n=t.toString();for(;n.length<o;)n="0"+n;return n};var q=t=>{let o=Math.floor(t/1e3),n=Math.floor(o/60),s=t%1e3,r=Math.floor(s/10);return d(n)+"."+d(o%60)+"."+d(r)},P=t=>t.reduce((o,n)=>o+n,0),L=t=>+(Math.round(t+"e+2")+"e-2"),le=(t,o)=>t-o,O=t=>t.concat().sort(le),j=t=>O(t).slice(1,-1),A=t=>{let o=t.split("."),n=Number(o[0]),s=Number(o[1]),r=Number(o[2]);return n*60+s+r/100},f=t=>{let o=Math.floor(t/60),n=t-o*60,s=Math.floor(n),r=Math.round(L(t-Math.floor(t))*100),i=[d(o),d(s),d(r)].join(".");return console.log("timeInSeconds: ".concat(t)),console.log("Math.floor(timeInSeconds): ".concat(Math.floor(t))),console.log("timeInSeconds - Math.floor(timeInSeconds): ".concat(t-Math.floor(t))),console.log("minutes: ".concat(o)),console.log("leftoverSeconds: ".concat(n)),console.log("seconds: ".concat(s)),console.log("hundredths: ".concat(r)),console.log("timeString: ".concat(i)),i};var g={small:[{text:"F",label:"front face",axis:"z"},{text:"B",label:"back face",axis:"z"},{text:"U",label:"top (up) face",axis:"y"},{text:"D",label:"bottom (down) face",axis:"y"},{text:"L",label:"left face",axis:"x"},{text:"R",label:"right face",axis:"x"}],medium:[{text:"F",label:"front face",axis:"z"},{text:"B",label:"back face",axis:"z"},{text:"U",label:"top (up) face",axis:"y"},{text:"D",label:"bottom (down) face",axis:"y"},{text:"L",label:"left face",axis:"x"},{text:"R",label:"right face",axis:"x"},{text:"2F",label:"front two layers",axis:"z"},{text:"2B",label:"back two layers",axis:"z"},{text:"2U",label:"top (up) two layers",axis:"y"},{text:"2D",label:"bottom (down) two layers",axis:"y"},{text:"2L",label:"left two layers",axis:"x"},{text:"2R",label:"right two layers",axis:"x"}],large:[{text:"F",label:"front face",axis:"z"},{text:"B",label:"back face",axis:"z"},{text:"U",label:"top (up) face",axis:"y"},{text:"D",label:"bottom (down) face",axis:"y"},{text:"L",label:"left face",axis:"x"},{text:"R",label:"right face",axis:"x"},{text:"2F",label:"front two layers",axis:"z"},{text:"2B",label:"back two layers",axis:"z"},{text:"2U",label:"top (up) two layers",axis:"y"},{text:"2D",label:"bottom (down) two layers",axis:"y"},{text:"2L",label:"left two layers",axis:"x"},{text:"2R",label:"right two layers",axis:"x"},{text:"3F",label:"front three layers",axis:"z"},{text:"3B",label:"back three layers",axis:"z"},{text:"3U",label:"top (up) three layers",axis:"y"},{text:"3D",label:"bottom (down) three layers",axis:"y"},{text:"3L",label:"left three layers",axis:"x"},{text:"3R",label:"right three layers",axis:"x"}]};var ce=()=>{let t=[{text:"",label:"90\xBA clockwise"},{text:"&rsquo;",label:"90\xBA anticlockwise"},{text:"2",label:"180\xBA"}],o=Math.floor(Math.random()*t.length);return t[o]},ae=t=>{let o=[],n={"2x2x2":{numMoves:25,turns:g.small},"3x3x3":{numMoves:30,turns:g.small},"4x4x4":{numMoves:35,turns:g.medium},"5x5x5":{numMoves:35,turns:g.medium},"6x6x6":{numMoves:45,turns:g.large},"7x7x7":{numMoves:55,turns:g.large}};n.mirror3x3x3=n["3x3x3"];let s=n[t];for(;o.length<s.numMoves;){let r=Math.floor(Math.random()*s.turns.length),i=s.turns[r],m=ce(),c=(w,v)=>{o.push({move:w,modifier:v})};(o.length===0||o[o.length-1].move.axis!==i.axis)&&c(i,m)}return o},me=()=>ae(e.puzzle),p=()=>{if(e.scrambleEl){let t=me();console.log(t);let o="<ul>",n="</ul>";for(let s of t)o+='<li><span class="moveLabel" title="Turn the '.concat([s.move.label,s.modifier.label].join(" "),'">').concat(s.move.text+s.modifier.text,"</span></li>");o+=n,e.scrambleEl.innerHTML=o}};var u=t=>{let{text:o,type:n="info"}=t;Toastify({text:o,className:"toast-".concat(n)}).showToast()};var T=()=>{b(),h(),p()},R=()=>{let t=e.defaults.puzzle;if(e.configObj.puzzle&&(t=e.configObj.puzzle),e.puzzle=t,console.log("timerSettings.puzzle: ".concat(e.puzzle)),e.selectPuzzleEl){for(let o of e.selectPuzzleEl.querySelectorAll("option")){let n=o;n.selected=!1}e.selectPuzzleEl.querySelector("#puzzle_"+t).selected=!0,T()}},H=()=>{e.puzzle=e.selectPuzzleEl.value,console.log("timerSettings.puzzle: ".concat(e.puzzle)),u({text:"Puzzle: ".concat(e.puzzle)}),a(),T()};var N=t=>{if(!t||t.length===0)return{};let o=[],n={};for(let[s,r]of t.entries())o[s]=A(r.time);return n.average=f(x(o,o.length)),n.best=f(ue(o)),o.length>=5&&(n.average5=f(x(o,5)),n.a3of5=f(x(o,5,!0))),o.length>=10&&(n.average10=f(x(o,10))),o.length>=12&&(n.a10of12=f(x(o,12,!0))),n},x=(t,o,n)=>{let s=[],r=o;for(let c=0;c<o;c++)s.push(t[t.length-1-c]);n&&(s=j(s),r=o-2);let i=P(s);return L(i/r)},ue=t=>{let o=O(t);return console.log("BEST LOL "+o[0]),o[0]},F=t=>{let o='<ul id="averages-list">',n="</ul>",s=[{label:"Average",value:t.average||"...",tooltip:"The mean average of all times recorded for this puzzle"},{label:"Best time",value:t.best||"...",tooltip:"The fastest time recorded for this puzzle"},{label:"Average 5",value:t.average5||"...",tooltip:"The mean average of the most recent 5 times recorded for this puzzle"},{label:"A3of5",value:t.a3of5||"...",tooltip:"The mean average of the most recent 5 times recorded for this puzzle, with the fastest and slowest times removed"},{label:"Average 10",value:t.average10||"...",tooltip:"The mean average of the most recent 10 times recorded for this puzzle"},{label:"A10of12",value:t.a10of12||"...",tooltip:"The mean average of the most recent 12 times recorded for this puzzle, with the fastest and slowest times removed"}],r="";for(let i of s){let m='<li><span class="averageLabelOuter"><span class="averageLabel" title="'.concat(i.tooltip,'">').concat(i.label,':</span></span> <span class="averageTime">').concat(i.value,"</span></li>");r+=m}return o+r+n};var B=()=>{let o=localStorage.getItem(e.timesStorageItem)||"{}";e.timesObj=JSON.parse(o)},de=()=>{console.log("-----> clearTimesInlinePopup"),document.querySelector("#clear-times-confirm").classList.remove("hide")},fe=()=>{document.querySelector("#clear-times-confirm").classList.add("hide")},h=t=>{let o=document.querySelector("#times");if(o){console.log("getting times");let n=[];if(B(),e.timesObj[e.puzzle]&&(n=e.timesObj[e.puzzle]),console.log("TIMESARRAY"),console.log(n),n.length===0){o.innerHTML="";return}let s=0,r=!1;n.length>e.timesListLength&&(s=n.length-e.timesListLength,r=!0);let i='<div id="times-container"><h2>Times for '.concat(e.puzzle,'</h2><button id="clear-times">Clear</button><div id="clear-times-confirm" class="inline-popup hide"><p>Delete all times for ').concat(e.puzzle,'?</p><div class="confirm-buttons-holder"><button id="clear-times-for-real" class="warning-button">Yes, delete them</button><button id="clear-times-cancel">No, keep them</button></div></div><div id="times-list-outer"><ul id="times-list">'),m="</ul>";r&&(m+='<button id="view-all-button">View all</button>'),m+="</div></div>";let c="",w=t?" new":"";for(let l=s;l<n.length;l++)c+='<li><span class="count">',c+=d(l+1,4),c+=':</span> <span class="time'.concat(l===n.length-1?w:"",'"'),n[l].timestamp&&(c+=' title="'.concat(n[l].timestamp,'"')),c+=">",c+=n[l].time,c+="</span>",c+='<button class="deleteTime" data-timeindex="'.concat(l,'">Delete</button>'),c+="</li>";let v=N(n);console.log(v);let re=F(v);o.innerHTML=i+c+m+re,document.querySelector("#times-list-outer").scrollTop=document.querySelector("#times-list").offsetHeight,document.querySelector("#view-all-button")&&document.querySelector("#view-all-button").addEventListener("click",l=>{l.preventDefault(),l.target.blur(),document.location.href="/times/?puzzle=".concat(e.puzzle)}),document.querySelector("#clear-times").addEventListener("click",l=>{l.preventDefault(),l.target.blur(),de()}),document.querySelector("#clear-times-for-real").addEventListener("click",l=>{l.preventDefault(),l.target.blur(),C()}),document.querySelector("#clear-times-cancel").addEventListener("click",l=>{l.preventDefault(),l.target.blur(),fe()})}},V=()=>{let o=document.querySelector("#times").querySelectorAll(".time");for(let n of o)n.classList.remove("new")},E=()=>{localStorage.setItem(e.timesStorageItem,JSON.stringify(e.timesObj))},U=t=>{let o=t.dataset.timeindex;console.log("timeIndex: ".concat(o)),console.log("times before:"),console.log(e.timesObj[e.puzzle]),e.timesObj[e.puzzle].splice(o,1),console.log("times after:"),console.log(e.timesObj[e.puzzle]),E(),h(),document.querySelector("#times-full-list")&&k()},C=()=>{e.timesObj[e.puzzle]=[],E(),T()},G=()=>{let t=e.timerEl.textContent,n=new Date().toLocaleString("en-GB"),s=[];console.log("storing ".concat(t)),e.timesObj[e.puzzle]&&(s=e.timesObj[e.puzzle]),s.push({time:t,timestamp:n}),e.timesObj[e.puzzle]=s,E(),h(!0)},k=()=>{let t=document.querySelector("#times-full-list");if(t){B();let o=e.timesObj[e.puzzle],n=document.querySelectorAll(".puzzle");console.log("-----> initTimesList"),console.log("\n\n-----> BIG DUMP\n\n"),console.log(e.timesObj),console.log("\n\n-----> END BIG DUMP\n\n"),console.log("timerSettings.puzzle: ".concat(e.puzzle)),console.log(o);for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&(console.log("span: ".concat(s)),n[s].textContent=e.puzzle);if(o&&o.length>0){let s="";for(let r=o.length-1;r>=0;r--){let i=o[r],m='<li><span class="count">'.concat(d(r+1,4),':</span> <span class="time">').concat(i.time,'</span> <span class="timestamp">').concat(i.timestamp,'</span> <button class="deleteTime" data-timeindex="').concat(r,'">Delete</button></li>');s+=m}t.innerHTML=s}else t.innerHTML="<li>No times recorded</li>"}};var J=()=>{if(e.timerEl){let t=document.createElement("button");t.id="timer",t.innerHTML=e.timerEl.innerHTML,e.timerEl.parentNode.replaceChild(t,e.timerEl),e.timerEl=t}},b=()=>{e.timerEl&&(console.log("HARD STOP"),window.clearInterval(e.timerIntervalVar),e.timerEl.innerHTML=e.defaultState,e.timerRunning=!1,e.cooldown=!1,V(),document.body.classList.remove("countdownRunning"),document.body.classList.remove("timerRunning"),e.countdownRunning=!1,e.timerEl.focus(),p())},_=()=>{console.log("checkTimer"),e.currTime=Date.now();let t=e.currTime-e.startTime;e.timerEl.textContent=q(t)},D=()=>{console.log("start timer"),e.timerEl.classList.add("start"),window.setTimeout(()=>{e.timerEl.classList.remove("start")},1e3),window.clearInterval(e.timerIntervalVar),e.countdownRunning=!1,e.timerRunning=!0,document.body.classList.remove("countdownRunning"),document.body.classList.add("timerRunning"),e.startTime=Date.now(),e.focusOn?e.timerEl.textContent="Go!":e.timerIntervalVar=window.setInterval(()=>{_()},e.timerInterval),e.soundsOn&&document.querySelector("#sounds-startTimer").play(),e.timerEl.focus()},W=()=>{console.log("stop timer"),window.clearInterval(e.timerIntervalVar),e.cooldown||(e.cooldown=!0,_(),document.body.classList.remove("timerRunning"),e.timerEl.classList.remove("start"),e.timerEl.classList.add("cooldown"),e.soundsOn&&document.querySelector("#sounds-finished").play(),G(),p(),window.setTimeout(()=>{e.timerRunning=!1,e.cooldown=!1,e.timerEl.classList.remove("cooldown")},e.cooldownMs))};var Y=()=>{let t=Number(e.defaults.countdownDuration);if(e.configObj.countdownDuration&&(t=Number(e.configObj.countdownDuration)),e.countdownDuration=t,e.countdownDurationEl){for(let o of e.countdownDurationEl.querySelectorAll("option")){let n=o;n.selected=!1}e.countdownDurationEl.querySelector("#duration"+t).selected=!0}},K=()=>{e.countdownDuration=Number(e.countdownDurationEl.value),console.log("timerSettings.countdownDuration: ".concat(e.countdownDuration)),u({text:"Inspection time set: ".concat(e.countdownDuration," seconds")}),a()},Q=()=>{if(e.countdownDuration===0)return D();console.log("start countdown"),e.soundsOn&&document.querySelector("#sounds-startCountdown").play(),e.timerRunning=!1,e.countdownRunning=!0,document.body.classList.add("countdownRunning"),e.countdownPings=[],e.startTime=Date.now(),window.clearInterval(e.timerIntervalVar),e.timerIntervalVar=window.setInterval(()=>{ge()},e.countdownInterval)},ge=()=>{e.currTime=Date.now();let t=e.currTime-e.startTime,o=Math.floor(t/1e3),n=e.countdownDuration-o;if(e.timerEl.textContent=n.toString(),n===0)return e.timerEl.classList.remove("flash"),D();n<4&&e.countdownPings[n]!==!0&&(e.countdownPings[n]=!0,e.timerEl.classList.add("flash"),window.setTimeout(()=>{e.timerEl.classList.remove("flash")},750),e.soundsOn&&document.querySelector("#sounds-ping").play())};var X=()=>{let t=e.defaults.soundsOn;e.configObj.soundsOn&&(t=e.configObj.soundsOn),e.soundsOn=t,console.log("timerSettings.soundsOn: ".concat(e.soundsOn)),e.soundCheckbox&&(e.soundCheckbox.checked=t)},Z=()=>{e.soundsOn=e.soundCheckbox.checked,console.log("timerSettings.soundsOn: ".concat(e.soundsOn)),u({text:"Sounds: ".concat(e.soundsOn?"on":"off")}),a()};var ee=()=>{let t=e.defaults.focusOn;e.configObj.focusOn&&(t=e.configObj.focusOn),e.focusOn=t,console.log("timerSettings.focusOn: ".concat(e.focusOn)),e.focusCheckbox&&(e.focusCheckbox.checked=t)},te=()=>{e.focusOn=e.focusCheckbox.checked,console.log("timerSettings.focusOn: ".concat(e.focusOn)),u({text:"Focus mode: ".concat(e.focusOn?"on":"off")}),a()};var oe=()=>{let t=e.defaults.theme;e.configObj.theme&&(t=e.configObj.theme),se(),e.theme=t,document.body.classList.add(t),he(),console.log("timerSettings.theme: ".concat(e.theme))},ne=()=>{e.theme=e.themeDropdown.value,se(),document.body.classList.add(e.theme),u({text:"Theme: ".concat(e.theme)}),a()},pe=()=>e.themesAvailable,se=()=>{let t=pe();for(let o of t)document.body.classList.remove(o)},he=()=>{if(e.themeDropdown){let t=e.themeDropdown.querySelectorAll("option");for(let o of t)o.value===e.theme&&(o.selected=!0)}};var y=t=>{if(!(t.tagName.toLowerCase()==="input"||t.tagName.toLowerCase()==="select")&&!e.modalVisible){if(e.timerRunning)return W();if(e.countdownRunning)return e.countdownRunning=!1,document.body.classList.remove("countdownRunning"),window.clearInterval(e.timerIntervalVar);Q()}},ie=()=>{b()},M=()=>{be()},be=()=>{e.userCanHover=!0,document.body.classList.add("hover"),window.removeEventListener("mouseover",M,!1)};var xe=()=>{console.log("init timer js"),document.body.classList.add("js"),window.addEventListener("mouseover",M,!1),J(),$(),S(),Y(),X(),ee(),oe(),R(),z(),p(),h(),k(),e.timerEl&&(e.timerEl.innerHTML=e.defaultState,e.timerEl.addEventListener("click",t=>{console.log("timer clicked"),console.log("timerSettings.timerRunning: "+e.timerRunning),console.log("timerSettings.countdownRunning: "+e.countdownRunning),t.preventDefault(),y(t.target)},!1)),e.countdownDurationEl&&e.countdownDurationEl.addEventListener("change",()=>{K()}),e.soundCheckbox&&e.soundCheckbox.addEventListener("change",()=>{Z()}),e.focusCheckbox&&e.focusCheckbox.addEventListener("change",()=>{te()}),e.themeDropdown&&e.themeDropdown.addEventListener("change",()=>{ne()}),e.selectPuzzleEl&&e.selectPuzzleEl.addEventListener("change",()=>{H()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&ie(),t.key===" "&&t.target.tagName.toLowerCase()==="body"&&(e.timerEl.focus(),y(e.timerEl))}),document.addEventListener("click",t=>{t.target.classList.contains("deleteTime")&&U(t.target),t.target.classList.contains("delete_times_yes_button")&&C(),t.target.id==="cancel-button"&&(console.log("CANCEL"),b())}),document.addEventListener("touchend",t=>{(e.countdownRunning||e.timerRunning)&&(t.preventDefault(),y(t.target))},!1)};window.addEventListener("load",xe);})();
//# sourceMappingURL=main-0726155.js.map */
